private static void addArrayIfNotBlank(ObjectNode node, String field, Object value) {
    if (value == null) return;

    ArrayNode arrayNode = node.putArray(field);
    if (value instanceof String) {
        String s = ((String) value).trim();
        if (!s.isEmpty()) arrayNode.add(s);
    } else if (value instanceof List<?>) {
        for (Object v : (List<?>) value) {
            if (v != null && !v.toString().isBlank()) arrayNode.add(v.toString());
        }
    } else {
        // handle comma-separated strings
        String s = value.toString();
        if (s.contains(",")) {
            for (String part : s.split(",")) {
                if (!part.isBlank()) arrayNode.add(part.trim());
            }
        } else if (!s.isBlank()) {
            arrayNode.add(s);
        }
    }
}